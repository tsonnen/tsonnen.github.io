<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <script src="js/jquery-2.1.4.js"></script>
    <script src="js/bootstrap.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('#exit').click(function(){
                location.href="proj.html";
            });
        });
    </script>
    <title>RFID Unlock</title>
</head>
<body>
    <div class="jumbotron">
        <h1>RFID Computer Unlock</h1>
    </div>
    <div id="body" class="text">
	<img src="css/images/rfid.png" class="img-rounded" style="display: block; margin-left: auto; margin-right: auto;">
        <div style="width:1000px; margin:0 auto;">
            <p>The Idea behind this application was that I wanted a simpler way to unlock my computer. 
            I was experimenting with RFID technology at the time and was interesting in developing a solution using this
            solution.</p>
            <p>As my computer does not actually have any GPIO pins, and I already had a RFID reader for the Arduino,
            I decided to use this as my platform for my test. Also, since devices are accessable as files under Linux, I was able
            to listen to the serial communications of the Arduino while it was connected via USB to my computer.</p>
            <p>The code that runs on the PC that listens to the Arduino is written in C while the code that runs on the Arduino
            is written in its native language(a subset of C/C++)</p>
            <h3>main.c (runs on the host computer)</h3>
            <pre style='color:#000000;background:#ffffff;'><span style='color:#696969; '>/* Tim Sonnen  5/30/2016 </span>
<span style='color:#696969; '>&#xa0;* v 1.0</span>
<span style='color:#696969; '>&#xa0;* This code runs on a host PC and listens to a specified serial port.</span>
<span style='color:#696969; '>&#xa0;*/</span>
 
 
 <span style='color:#696969; '>/* To use this with other RFID readers you may have to</span>
<span style='color:#696969; '>&#xa0;* adjust the delay between the reads (Currently at 500ms)</span>
<span style='color:#696969; '>&#xa0;*/</span>

<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>stdio.h</span><span style='color:#800000; '>></span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>stdint.h</span><span style='color:#800000; '>></span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>stdlib.h</span><span style='color:#800000; '>></span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>unistd.h</span><span style='color:#800000; '>></span><span style='color:#004a43; '>         </span><span style='color:#696969; '>/*Used for UART*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>fcntl.h</span><span style='color:#800000; '>></span><span style='color:#004a43; '>          </span><span style='color:#696969; '>/*Used for UART*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>termios.h</span><span style='color:#800000; '>></span><span style='color:#004a43; '>        </span><span style='color:#696969; '>/*Used for UART*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>string.h</span><span style='color:#800000; '>></span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>time.h</span><span style='color:#800000; '>></span>


<span style='color:#696969; '>/*Prototypes*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> readData<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> fd<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>rx<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>void</span> lock<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>void</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>void</span> unlock<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>void</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

<span style='color:#696969; '>/*Constants*/</span>


<span style='color:#696969; '>/*Variables*/</span>
<span style='color:#800000; font-weight:bold; '>int</span> <span style='color:#603000; '>count</span>  <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>int</span> locked <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>int</span> wm     <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> <span style='color:#696969; '>/*Default to xscreensaver (wm =1 is GNOME screensaver)*/</span>

<span style='color:#800000; font-weight:bold; '>int</span> <span style='color:#400000; '>main</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> argc<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>argv<span style='color:#808030; '>[</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>

    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>argc <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#603000; '>printf</span><span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>USAGE:[SERIAL PORT] [SCREEN SAVER]</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>ex. ./serial /dev/ttyACM0 -x</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>-x = xscreensaver(DEFUALT)</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>-g=GNOME screensaver</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>
    <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>device <span style='color:#808030; '>=</span> argv<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>screensaver <span style='color:#808030; '>=</span> argv<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Check the arguments and make sure they are in the correct locations*/</span>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>screensaver<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'-'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        device <span style='color:#808030; '>=</span> argv<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
        screensaver <span style='color:#808030; '>=</span> argv<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>

    <span style='color:#800000; font-weight:bold; '>switch</span> <span style='color:#808030; '>(</span>screensaver<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'x'</span><span style='color:#e34adc; '>:</span>
            wm <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'g'</span><span style='color:#e34adc; '>:</span>
            wm <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
<span style='color:#e34adc; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#800000; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
            <span style='color:#603000; '>printf</span><span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>INVALID ARGUMENT.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Please try again</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>

    <span style='color:#800000; font-weight:bold; '>int</span> fd <span style='color:#808030; '>=</span> open<span style='color:#808030; '>(</span>device<span style='color:#808030; '>,</span> O_RDWR <span style='color:#808030; '>|</span> O_NOCTTY <span style='color:#808030; '>|</span> O_NDELAY<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>fd <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#603000; '>printf</span><span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>ERROR-Could not open device</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Check that serial port is correct</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>

    <span style='color:#800000; font-weight:bold; '>struct</span> termios options<span style='color:#800080; '>;</span>
        tcgetattr<span style='color:#808030; '>(</span>fd<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>options<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        options<span style='color:#808030; '>.</span>c_cflag <span style='color:#808030; '>=</span> B9600 <span style='color:#808030; '>|</span> CS8 <span style='color:#808030; '>|</span> CLOCAL <span style='color:#808030; '>|</span> CREAD<span style='color:#800080; '>;</span>     <span style='color:#696969; '>/*Set baud rate*/</span>
        options<span style='color:#808030; '>.</span>c_iflag <span style='color:#808030; '>=</span> IGNPAR<span style='color:#800080; '>;</span>
        options<span style='color:#808030; '>.</span>c_oflag <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
        options<span style='color:#808030; '>.</span>c_lflag <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
        tcflush<span style='color:#808030; '>(</span>fd<span style='color:#808030; '>,</span> TCIFLUSH<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        tcsetattr<span style='color:#808030; '>(</span>fd<span style='color:#808030; '>,</span> TCSANOW<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>options<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> rx1<span style='color:#808030; '>[</span><span style='color:#008c00; '>255</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
        readData<span style='color:#808030; '>(</span>fd<span style='color:#808030; '>,</span> rx1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#603000; '>count</span> <span style='color:#808030; '>></span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>locked <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
                locked<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
                unlock<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
            <span style='color:#603000; '>count</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
            

        <span style='color:#800080; '>}</span>
        <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#603000; '>count</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>10</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            <span style='color:#603000; '>count</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>locked <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
                locked <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
                lock<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
        <span style='color:#800080; '>}</span>
        <span style='color:#696969; '>/*printf("%i\n", count )*/</span><span style='color:#800080; '>;</span>
        usleep<span style='color:#808030; '>(</span><span style='color:#008c00; '>500000</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>
<span style='color:#800080; '>}</span>

<span style='color:#800000; font-weight:bold; '>void</span> readData<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> fd<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>rx<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
<span style='color:#696969; '>/* Read up to 255 characters from the port if they are there*/</span>
    <span style='color:#800000; font-weight:bold; '>int</span> rx_length <span style='color:#808030; '>=</span> read<span style='color:#808030; '>(</span>fd<span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>void</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span>rx<span style='color:#808030; '>,</span> <span style='color:#008c00; '>255</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>       <span style='color:#696969; '>/*Filestream, buffer to store in, number of bytes to read (max)*/</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> card<span style='color:#808030; '>[</span><span style='color:#008c00; '>12</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#800080; '>{</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> answer<span style='color:#808030; '>[</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#800080; '>{</span><span style='color:#0000e6; '>'4'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'5'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'1'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'B'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'5'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'9'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'6'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'7'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'6'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'8'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'1'</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>'8'</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>rx_length <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>
    <span style='color:#800080; '>{</span>
        <span style='color:#696969; '>/*No card is detected*/</span>
       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>locked <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
                <span style='color:#603000; '>count</span><span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
            <span style='color:#800000; font-weight:bold; '>else</span><span style='color:#800080; '>{</span>
                <span style='color:#603000; '>count</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span> 
    <span style='color:#800080; '>}</span>
    <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>rx_length <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        rx<span style='color:#808030; '>[</span>rx_length<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\0'</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i <span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i<span style='color:#808030; '>&lt;</span>rx_length<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            card<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span>rx<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
        <span style='color:#800080; '>}</span>
        card<span style='color:#808030; '>[</span>rx_length<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
        answer<span style='color:#808030; '>[</span>rx_length<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>

        <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#603000; '>memcmp</span><span style='color:#808030; '>(</span>card<span style='color:#808030; '>,</span> answer<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>sizeof</span><span style='color:#808030; '>(</span>card<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>locked <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
                <span style='color:#603000; '>count</span><span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
            <span style='color:#800000; font-weight:bold; '>else</span><span style='color:#800080; '>{</span>
                <span style='color:#603000; '>count</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
        <span style='color:#800080; '>}</span>
        <span style='color:#800000; font-weight:bold; '>else</span><span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>locked <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
                <span style='color:#603000; '>count</span><span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
            <span style='color:#800000; font-weight:bold; '>else</span><span style='color:#800080; '>{</span>
                <span style='color:#603000; '>count</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
            <span style='color:#800080; '>}</span>
        <span style='color:#800080; '>}</span>
    <span style='color:#800080; '>}</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Locks the Screen*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> lock<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>void</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    pid_t pid<span style='color:#800080; '>;</span>

    pid <span style='color:#808030; '>=</span>  fork<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>pid<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#603000; '>printf</span><span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>No valid card detected. Locking computer</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        sleep<span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>switch</span> <span style='color:#808030; '>(</span>wm<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#008c00; '>0</span><span style='color:#e34adc; '>:</span>
                execl<span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>-c</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>xscreensaver-command -lock</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span><span style='color:#808030; '>)</span> <span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
                <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#008c00; '>1</span><span style='color:#e34adc; '>:</span>
                execl<span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>-c</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>gnomescreensaver-command -l</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span><span style='color:#808030; '>)</span> <span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
                <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
<span style='color:#e34adc; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#800000; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
                <span style='color:#696969; '>/*NOTHING*/</span>
                <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
        <span style='color:#800080; '>}</span>
        
    <span style='color:#800080; '>}</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Unlocks the computer*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> unlock<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>void</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    pid_t pid<span style='color:#800080; '>;</span>

    pid <span style='color:#808030; '>=</span>  fork<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>pid<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#603000; '>printf</span><span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>Valid card detected. Unlocking</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        sleep<span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>switch</span> <span style='color:#808030; '>(</span>wm<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#008c00; '>0</span><span style='color:#e34adc; '>:</span>
                execl<span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>-c</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>xscreensaver-command -deactivate</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span><span style='color:#808030; '>)</span> <span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
                <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#008c00; '>1</span><span style='color:#e34adc; '>:</span>
                execl<span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>/bin/sh</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>-c</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>gnomescreensaver-command -d</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span><span style='color:#808030; '>)</span> <span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
                <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
<span style='color:#e34adc; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#800000; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
                <span style='color:#696969; '>/*NOTHING*/</span>
                <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
        <span style='color:#800080; '>}</span>
    <span style='color:#800080; '>}</span>
<span style='color:#800080; '>}</span>
</pre>

            <p> This code is fairly straight forward if you are familiar with the way that C accesses serial ports. It takes in two arguments, the serial port of the Arduino, and the window manager that
                is used (-x for xscreensaver or -g for GNOME screensaver). As of late, GNOME screensaver is easier to use for full capabilities as xscreensaver will not autounlock your computer without a
                PAM module.</p>
            <h3>RFIDunlock.ino</h3>
<pre style='color:#000000;background:#ffffff;'><span style='color:#696969; '>/* Tim Sonnen 5/30/16 </span>
<span style='color:#696969; '>&#xa0;* v 1.0 </span>
<span style='color:#696969; '>&#xa0;*</span>
<span style='color:#696969; '>&#xa0;* This code reads MiFare cards and runs on a Mifare RC522 </span>
<span style='color:#696969; '>&#xa0;* card reader (available on Amazon). This code is currently written/</span>
<span style='color:#696969; '>&#xa0;* documented for use on Arduino Uno. However, it should be possible to move</span>
<span style='color:#696969; '>&#xa0;* it over to any similar ATMEL microcontroller.</span>
<span style='color:#696969; '>&#xa0;* PINOUT FOR ARDUINO UNO:</span>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Pin 5 - Reset</span>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Pin 10 - NSS (Slave Select)</span>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Pin 11 - MOSI (Master Out/Slave In)</span>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Pin 12 - MISO (Master In/Slave Out)</span>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Pin 13 - SCK (System Clock)</span>
<span style='color:#696969; '>&#xa0;*/</span>

<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>SPI.h</span><span style='color:#800000; '>></span>

<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> MAX_LEN     16</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> CHIP_SELECT 10</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> NRSTPD      5</span>

<span style='color:#696969; '>/*Registers*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> COMMAND_REG     0x01   </span><span style='color:#696969; '>/*Starts/Stops command execution*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> COMLEN_REG      0x02   </span><span style='color:#696969; '>/*Enable/Disable interupt request control bits*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> COMIRQ_REG      0x04   </span><span style='color:#696969; '>/*Interupt request bits*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> ERROR_REG       0x06   </span><span style='color:#696969; '>/*Error bits showing the ERROR status of last command*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> FIFODATA_REG    0x09   </span><span style='color:#696969; '>/*Input/Output of 64 Byte FIFO*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> FIFOLEVEL_REG   0x0A   </span><span style='color:#696969; '>/*Number of bytes stored in the FIFO*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> CONTROL_REG     0x0C   </span><span style='color:#696969; '>/*Various control registers*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> BITFRAMING_REG  0x0D   </span><span style='color:#696969; '>/*Adjustments for bit oriented frames*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> MODE_REG        0x11   </span><span style='color:#696969; '>/*Defines general modes for transmitting/recieving*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> TXCONTROL_REG   0x14   </span><span style='color:#696969; '>/*Controls the antenna*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> TXASK_REG       0x15   </span><span style='color:#696969; '>/*Controls the ASK modulation*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> TMODE_REG       0x2A   </span><span style='color:#696969; '>/*Define Settings for internal timer*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> TPRESCALER_REG  0x2B   </span><span style='color:#696969; '>/*Define Settings for internal timer*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> TRELOAD_REGL    0x2C   </span><span style='color:#696969; '>/*Define the 16 bit timer reload value*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> TRELOAD_REGH    0x2D   </span><span style='color:#696969; '>/*Define the 16 bit timer reload value*/</span>

<span style='color:#696969; '>/*Commands for the RFID reader*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> IDLE            0x00   </span><span style='color:#696969; '>/*NOTHING*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> TRANSCEIVE      0x0C   </span><span style='color:#696969; '>/*Transfer and recieve data*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> AUTHENT         0x0E   </span><span style='color:#696969; '>/*Authentication Key*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> RESET_PHRASE    0x0F   </span><span style='color:#696969; '>/*Reset*/</span>

<span style='color:#696969; '>/*Commands for the Card*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> REQ_IDL         0x26   </span><span style='color:#696969; '>/*Make sure the antenna does not enter hibernation*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> ANTICOLL        0x93   </span><span style='color:#696969; '>/*Anti-Collision*/</span>

<span style='color:#696969; '>/*Show status*/</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> MI_OK                 0</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> MI_NOTAGERR           1</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> MI_ERR                2</span>

<span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> serNum<span style='color:#808030; '>[</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>

<span style='color:#696969; '>/*prototypes*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> RFIDinit<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>void</span> reset<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>void</span> transfer<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> reg<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> val<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> recieve<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> reg<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>void</span> setBitMask<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> reg<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> mask<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800000; font-weight:bold; '>void</span> clearBitMask<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

<span style='color:#800000; font-weight:bold; '>void</span> 
setup <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#696969; '>/*Start Serial Communications that are used for communication with the host PC*/</span>
    Serial<span style='color:#808030; '>.</span>begin<span style='color:#808030; '>(</span><span style='color:#008c00; '>9600</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Start SPI (Used for the RFID reader)*/</span>
    SPI<span style='color:#808030; '>.</span>begin<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Initialize the GPIO that will be used*/</span>
    pinMode<span style='color:#808030; '>(</span>CHIP_SELECT<span style='color:#808030; '>,</span> OUTPUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    pinMode<span style='color:#808030; '>(</span>NRSTPD<span style='color:#808030; '>,</span> OUTPUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    digitalWrite<span style='color:#808030; '>(</span>CHIP_SELECT<span style='color:#808030; '>,</span> HIGH<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    digitalWrite<span style='color:#808030; '>(</span>NRSTPD<span style='color:#808030; '>,</span> HIGH<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    RFIDinit<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#800000; font-weight:bold; '>void</span>
loop<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> i<span style='color:#808030; '>,</span>
                  tmp<span style='color:#808030; '>,</span>
                  checksum1<span style='color:#808030; '>,</span>
                  status<span style='color:#808030; '>,</span>
                  rx_sixe<span style='color:#808030; '>,</span>
                  blockAddr<span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> str<span style='color:#808030; '>[</span>MAX_LEN<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Search for a card*/</span>
    request<span style='color:#808030; '>(</span>REQ_IDL<span style='color:#808030; '>,</span> str<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    status <span style='color:#808030; '>=</span> anticol<span style='color:#808030; '>(</span>str<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#603000; '>memcpy</span><span style='color:#808030; '>(</span>serNum<span style='color:#808030; '>,</span> str<span style='color:#808030; '>,</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>status <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> MI_OK<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        checksum1 <span style='color:#808030; '>=</span> serNum<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>^</span> serNum<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>^</span> serNum<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>^</span> serNum<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>8</span><span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            Serial<span style='color:#808030; '>.</span>print<span style='color:#808030; '>(</span>serNum<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> HEX<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        <span style='color:#800080; '>}</span>
        delay<span style='color:#808030; '>(</span><span style='color:#008c00; '>500</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Initialize the reader*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> 
RFIDinit<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> temp<span style='color:#800080; '>;</span>

    digitalWrite<span style='color:#808030; '>(</span>NRSTPD<span style='color:#808030; '>,</span> HIGH<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    transfer<span style='color:#808030; '>(</span>COMMAND_REG<span style='color:#808030; '>,</span> RESET_PHRASE<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>   <span style='color:#696969; '>/*Reset the reader*/</span>

    <span style='color:#696969; '>/*Set the timer*/</span>
    transfer<span style='color:#808030; '>(</span>TMODE_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x8D</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    transfer<span style='color:#808030; '>(</span>TPRESCALER_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x3E</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    transfer<span style='color:#808030; '>(</span>TRELOAD_REGL<span style='color:#808030; '>,</span> <span style='color:#008c00; '>30</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    transfer<span style='color:#808030; '>(</span>TRELOAD_REGH<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    transfer<span style='color:#808030; '>(</span>TXASK_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x40</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    transfer<span style='color:#808030; '>(</span>MODE_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x3D</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Turn on the antenna*/</span>
    temp <span style='color:#808030; '>=</span> recieve<span style='color:#808030; '>(</span>TXCONTROL_REG<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>(</span>temp <span style='color:#808030; '>&amp;</span> <span style='color:#008000; '>0x03</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> setBitMask<span style='color:#808030; '>(</span>TXCONTROL_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x03</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Send data to the reader*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> 
transfer<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> reg<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> val<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#696969; '>/*Pull the Chip Select Low (Needed for communication with the reader)*/</span>
    digitalWrite<span style='color:#808030; '>(</span>CHIP_SELECT<span style='color:#808030; '>,</span> LOW<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Send data and format address in the correct way*/</span>
    SPI<span style='color:#808030; '>.</span>transfer<span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>reg <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> <span style='color:#008000; '>0x7E</span> <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    SPI<span style='color:#808030; '>.</span>transfer<span style='color:#808030; '>(</span>val<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Pull Chip Select High*/</span>
    digitalWrite<span style='color:#808030; '>(</span>CHIP_SELECT<span style='color:#808030; '>,</span> HIGH<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Read data from the reader*/</span>
<span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> 
recieve<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> reg<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> val<span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Pull the Chip Select Low (Needed for communication with the reader)*/</span>
    digitalWrite<span style='color:#808030; '>(</span>CHIP_SELECT<span style='color:#808030; '>,</span> LOW<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Read data and format address in the correct way*/</span>
    SPI<span style='color:#808030; '>.</span>transfer<span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>reg <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> <span style='color:#008000; '>0x7E</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#008000; '>0x80</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    val <span style='color:#808030; '>=</span> SPI<span style='color:#808030; '>.</span>transfer<span style='color:#808030; '>(</span><span style='color:#008000; '>0x00</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Pull Chip Select High*/</span>
    digitalWrite<span style='color:#808030; '>(</span>CHIP_SELECT<span style='color:#808030; '>,</span> HIGH<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#800000; font-weight:bold; '>return</span> val<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Finds cards and initializes the communications*/</span>
<span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span>
request<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> mode<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>tagType<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> status<span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>int</span> backBits<span style='color:#800080; '>;</span> <span style='color:#696969; '>/*Recieved Data*/</span>

    tagType<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> mode<span style='color:#800080; '>;</span> 

    transfer<span style='color:#808030; '>(</span>BITFRAMING_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x07</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    status <span style='color:#808030; '>=</span> toCard<span style='color:#808030; '>(</span>TRANSCEIVE<span style='color:#808030; '>,</span> tagType<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> tagType<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>backBits<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#800000; font-weight:bold; '>return</span> status<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Communicate with the card*/</span>
<span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span>
toCard<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> command<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>sendData<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> sendLen<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>backData<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>int</span> <span style='color:#808030; '>*</span>backLen<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> irqEn     <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x00</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> waitIRQ   <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x00</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> status<span style='color:#808030; '>,</span>
                  lastBits<span style='color:#808030; '>,</span>
                  n<span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#800080; '>;</span>

    <span style='color:#800000; font-weight:bold; '>switch</span> <span style='color:#808030; '>(</span>command<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>AUTHENT</span><span style='color:#e34adc; '>:</span>
            irqEn   <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x12</span><span style='color:#800080; '>;</span>
            waitIRQ <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x10</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
        <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>TRANSCEIVE</span><span style='color:#e34adc; '>:</span>
            irqEn   <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x77</span><span style='color:#800080; '>;</span>
            waitIRQ <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x30</span><span style='color:#800080; '>;</span>
            <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
<span style='color:#e34adc; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#800000; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
            <span style='color:#696969; '>/*NOTHING*/</span>
            <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>

    transfer<span style='color:#808030; '>(</span>COMLEN_REG<span style='color:#808030; '>,</span> irqEn<span style='color:#808030; '>|</span><span style='color:#008000; '>0x80</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#696969; '>/*Interupt request*/</span>
    clearBitMask<span style='color:#808030; '>(</span>COMIRQ_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x80</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>   <span style='color:#696969; '>/*Clear the interupt request bits*/</span>
    setBitMask<span style='color:#808030; '>(</span>FIFOLEVEL_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x80</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>  <span style='color:#696969; '>/*Initialize the FIFO*/</span>

    transfer<span style='color:#808030; '>(</span>COMMAND_REG<span style='color:#808030; '>,</span> IDLE<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Write data to the FIFO*/</span>
    <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> sendLen<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        transfer<span style='color:#808030; '>(</span>FIFODATA_REG<span style='color:#808030; '>,</span> sendData<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>

    <span style='color:#696969; '>/*Execute the command*/</span>
    transfer<span style='color:#808030; '>(</span>COMMAND_REG<span style='color:#808030; '>,</span> command<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>command <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> TRANSCEIVE<span style='color:#808030; '>)</span> setBitMask<span style='color:#808030; '>(</span>BITFRAMING_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x80</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#696969; '>/*Wait to finish recieving data*/</span>
    i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>2000</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>do</span><span style='color:#800080; '>{</span>
        n <span style='color:#808030; '>=</span> recieve<span style='color:#808030; '>(</span>COMIRQ_REG<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
        i<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>(</span>n<span style='color:#808030; '>&amp;</span><span style='color:#008000; '>0x01</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>(</span>n <span style='color:#808030; '>&amp;</span> waitIRQ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    clearBitMask<span style='color:#808030; '>(</span>BITFRAMING_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x80</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>(</span>recieve<span style='color:#808030; '>(</span>ERROR_REG<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> <span style='color:#008000; '>0x1B</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            status <span style='color:#808030; '>=</span> MI_OK<span style='color:#800080; '>;</span>

            <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>n <span style='color:#808030; '>&amp;</span> irqEn <span style='color:#808030; '>&amp;</span> <span style='color:#008000; '>0x01</span><span style='color:#808030; '>)</span> status <span style='color:#808030; '>=</span> MI_NOTAGERR<span style='color:#800080; '>;</span>

            <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>command <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> TRANSCEIVE<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
                n           <span style='color:#808030; '>=</span> recieve<span style='color:#808030; '>(</span>FIFOLEVEL_REG<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
                lastBits    <span style='color:#808030; '>=</span> recieve<span style='color:#808030; '>(</span>CONTROL_REG <span style='color:#808030; '>&amp;</span> <span style='color:#008000; '>0x07</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

                <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>lastBits<span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span>backLen <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>n<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> <span style='color:#008c00; '>8</span> <span style='color:#808030; '>+</span> lastBits<span style='color:#800080; '>;</span>
                <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#808030; '>*</span>backLen <span style='color:#808030; '>=</span> n <span style='color:#808030; '>*</span> <span style='color:#008c00; '>8</span><span style='color:#800080; '>;</span>

                <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>n <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> n <span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>

                <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span> n <span style='color:#808030; '>></span> MAX_LEN<span style='color:#808030; '>)</span> n <span style='color:#808030; '>=</span> MAX_LEN<span style='color:#800080; '>;</span>

                <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> n<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
                    backData<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> recieve<span style='color:#808030; '>(</span>FIFODATA_REG<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
                <span style='color:#800080; '>}</span>
            <span style='color:#800080; '>}</span>
        <span style='color:#800080; '>}</span>
        <span style='color:#800000; font-weight:bold; '>else</span> status <span style='color:#808030; '>=</span> MI_ERR<span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>

    <span style='color:#800000; font-weight:bold; '>return</span> status<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Anti-Collision. Gets the card Serial number*/</span>
<span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span>
anticol<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>serNum<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> serNumCheck <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> status<span style='color:#808030; '>,</span>
                  i<span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>int</span> unLen<span style='color:#800080; '>;</span>

    transfer<span style='color:#808030; '>(</span>BITFRAMING_REG<span style='color:#808030; '>,</span> <span style='color:#008000; '>0x00</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    serNum<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> ANTICOLL<span style='color:#800080; '>;</span>
    serNum<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x20</span><span style='color:#800080; '>;</span>

    status <span style='color:#808030; '>=</span> toCard<span style='color:#808030; '>(</span>TRANSCEIVE<span style='color:#808030; '>,</span> serNum<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>,</span> serNum<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>unLen<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>

    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>status <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> MI_OK<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
        <span style='color:#696969; '>/*Check the serial number*/</span>
        <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>4</span><span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
            serNumCheck <span style='color:#808030; '>^</span><span style='color:#808030; '>=</span> serNum<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
        <span style='color:#800080; '>}</span>
        <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>serNumCheck <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> serNum<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> status <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> MI_ERR<span style='color:#800080; '>;</span>
    <span style='color:#800080; '>}</span>
    <span style='color:#800000; font-weight:bold; '>return</span> status<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Set the bit mask*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> 
setBitMask<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> reg<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> mask<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> tmp<span style='color:#800080; '>;</span>
    tmp <span style='color:#808030; '>=</span> recieve<span style='color:#808030; '>(</span>reg<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    transfer<span style='color:#808030; '>(</span>reg<span style='color:#808030; '>,</span> tmp <span style='color:#808030; '>|</span> mask<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

<span style='color:#696969; '>/*Clear the bit mask*/</span>
<span style='color:#800000; font-weight:bold; '>void</span> 
clearBitMask<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> reg<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> mask<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>char</span> tmp<span style='color:#800080; '>;</span>
    tmp <span style='color:#808030; '>=</span> recieve<span style='color:#808030; '>(</span>reg<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    transfer<span style='color:#808030; '>(</span>reg<span style='color:#808030; '>,</span> tmp <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>mask<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span><span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>
</pre>

            <p>This code is fairly standard for any MiFare RC522 card reader, and since it just writes the card's ID into the serial port, it could be used for other automation applications.</p>
            <p>If you notice any mistakes, or have any questions/comments, please do not hesitate to contact me.</p>
            <div style="text-align:center;">
                <button class="btn btn-primary" id="exit">Back</button>
            </div>
        </div>
    </div>
</body>
